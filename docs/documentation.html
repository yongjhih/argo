<?xml version="1.0" encoding="UTF-8"?>
<!--
  ~ Copyright 2010 Mark Slater
  ~
  ~ Licensed under the Apache License, Version 2.0 (the "License"); you may not use this file except in compliance with the License. You may obtain a copy of the License at
  ~
  ~ 	http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~ Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions and limitations under the License.
  -->

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <title>Argo - A simple JSON parser and generator for Java - Documentation</title>
    <link rel="stylesheet" type="text/css" href="argo.css"/>
    <link rel="icon" type="image/png" href="/favicon-32x32.png" />
    <meta name="description" content="This tutorial describes generating JSON using argo, and all three parsing APIs."/>
</head>
<body>
<div id="root">
    <div id="header">
        <h1>Argo</h1>
    </div>
    <div id="navigation">
        <ul>
            <li><a href="index.html">Home</a></li>
            <li><a href="downloads.html">Downloads</a></li>
            <li><a href="documentation.html">Documentation</a></li>
            <li><a href="support.html">Support</a></li>
            <li><a href="https://sourceforge.net/projects/argo/">Project Site</a></li>
        </ul>
    </div>
    <div id="content">
        <h2>Documentation</h2>

        <h3>Introduction</h3>
        <p>This page provides an example-based guide to Argo.  In-depth details of the API are available in the
            <a href="javadoc/">online javadoc</a>, which can also be found in the
            <a href="https://sourceforge.net/projects/argo/files/latest">standard jar</a>.</p>
        <h3>Model of JSON in Argo</h3>
        <p>There is a good explanation of <a href="http://www.json.org/">the structure of JSON</a> at
            http://www.json.org/. Argo models JSON using five types of entity - two that can have children:</p>
        <ul>
            <li>Objects - pairs of a string and any entity type.</li>
            <li>Arrays - sequences of any entity type.</li>
        </ul>
        <p>and three types of leaf entity:</p>
        <ul>
            <li>Strings - essentially the same a Java Strings.</li>
            <li>Numbers - an unlimited precision number.</li>
            <li>Constants - true, false, and null.</li>
        </ul>

        <h3>Producing JSON</h3>
        <p>There are two steps to producing JSON using Argo: First, an instance of <code>JsonRootNode</code>
            representing the JSON is built, and then an instance of <code>JsonFormatter</code> is used to turn
            that into a <code>String</code> representation.</p>
        <p>A <code>JsonRootNode</code> represents either a JSON object or a JSON array.  They can have fields and
            elements consisting of instances <code>JsonNode</code>, which is the superclass of
            <code>JsonRootNode</code>.  A number of factory methods are provided for constructing <code>JsonNode</code>s
            and <code>JsonRootNode</code>s in the <code>JsonNodeFactories</code> class:</p> 
        <div class="code">import static argo.jdom.JsonNodeFactories.*;
            
...
            
JsonRootNode json = aJsonObject(
        aJsonField("name", aJsonString("Black Lace"))
        , aJsonField("sales", aJsonNumber("110921"))
        , aJsonField("totalRoyalties", aJsonNumber("10223.82"))
        , aJsonField("singles", aJsonArray(
                aJsonString("Superman")
                , aJsonString("Agadoo")
        ))
);</div>
        <p>All implementations of <code>JsonNode</code> and <code>JsonRootNode</code> are immutable.  The same
            <code>JsonRootNode</code> could have been built up in a mutable manner using the methods in
            <code>JsonNodeBuilders</code> class:</p>
        <div class="code">import static argo.jdom.JsonNodeBuilders.*;

...

JsonObjectNodeBuilder builder = anObjectBuilder()
        .withField("name", aStringBuilder("Black Lace"))
        .withField("sales", aNumberBuilder("110921"))
        .withField("totalRoyalties", aNumberBuilder("10223.82"))
        .withField("singles", anArrayBuilder()
                .withElement(aStringBuilder("Superman"))
                .withElement(aStringBuilder("Agadoo"))
        );
JsonRootNode json = builder.build();</div>
        <p>Finally, an instance of <code>JsonFormatter</code> is needed to produce JSON text from the
            <code>JsonRootNode</code>.  The two implementations provided are <code>PrettyJsonFormatter</code>, which
            produces easy to read JSON, and <code>CompactJsonFormatter</code>, which produces very brief JSON.
            Instances of both classes can safely be shared between threads.</p>
        <div class="code">private static final JsonFormatter JSON_FORMATTER
        = new PrettyJsonFormatter();

...

String jsonText = JSON_FORMATTER.format(json);</div>

        <h3>Parsing JSON into an Object</h3>
        <p>All the examples in this section are based on the following JSON, which is
        assumed to be available in a <code>String</code> called <code>jsonText</code>.</p>
        <div class="code">{
    "name": "Black Lace",
    "sales": 110921,
    "totalRoyalties": 10223.82,
    "singles": [
        "Superman", "Agadoo"
    ]
}</div>
        <p>The <code>JdomParser</code> class is used to generate a <code>JsonRootNode</code> from JSON text.  Instances
        of <code>JdomParser</code> can safely be shared between threads.</p>
        <div class="code">private static final JdomParser JDOM_PARSER = new JdomParser();

...

JsonRootNode json = JDOM_PARSER.parse(jsonText);</div>
        <p>Instances of <code>JsonRootNode</code> are immutable.  <code>JsonRootNode</code> and its parent
        <code>JsonNode</code> provide methods for exploring the generated structure, as specified in the javadoc.  The
        simplest of these are the <code>aXXXValue(Object... pathElements)</code> methods, which are used as follows:</p>
        <div class="code">String secondSingle = json.aStringValue("singles", 1);</div>

        <p>Alternatively, <code>JsonNodeSelector</code>s can be used to extract data from the <code>JsonRootNode</code>
        in a typesafe manner.<code>JsonNodeSelector</code>s are functions that can be applied to <code>JsonNode</code>s to extract a value
            or a child <code>JsonNode</code>.  The <code>JsonNodeSelectors</code> class provides a number of factory
            methods for constructing instances of <code>JsonNodeSelector</code>.  The following code gets the name of
        the second single (note that like arrays, the index of the first element is zero):</p>
        <div class="code">private static final JsonNodeSelector&lt;JsonNode,String&gt; SECOND_SINGLE
        = JsonNodeSelectors.aStringNode("singles", 1);

...

String secondSingle = SECOND_SINGLE.getValue(json);</div>
        <p>The singles can also be converted into a <code>List&lt;String&gt;</code>:</p>
        <div class="code">private static final JsonNodeSelector&lt;JsonNode, List&lt;JsonNode&gt;&gt; SINGLES
        = anArrayNode("singles");
private static final JsonNodeSelector&lt;JsonNode, String&gt; SINGLE_NAME
        = aStringNode();

...

List&lt;String&gt; singles = new AbstractList&lt;String&gt;() {
    public String get(int index) {
        return SINGLE_NAME.getValue(SINGLES.getValue(json).get(index));
    }

    public int size() {
        return SINGLES.getValue(json).size();
    }
};</div>
        <p>JSON number handling deserves a brief explanation.  JSON numbers are unlimited precision, and as such, cannot be
        represented by a Java primative like <code>double</code> or <code>int</code>.  The closest numeric
        representation offered by Java is <code>BigDecimal</code>, which accurately represents almost all JSON numbers,
        with the exception of some edge cases (for example, <code>-0</code> and <code>+0</code> are valid JSON numbers,
        but collapse to <code>BigDecimal.ZERO</code>).  For this reason, Argo doesn't do any implicit conversion of
        JSON numbers - they're treated as <code>String</code>s.  However, helper methods are provided for converting
        these <code>String</code>s to other Java numeric types.  For example, you could retrieve the total royalties
        from the example JSON as follows:</p>
        <div class="code">BigDecimal totalRoyalties = asBigDecimal(json.aNumberValue("totalRoyalties"));</div>

        <h3>Parsing JSON into events</h3>
        <p>The <code>SajParser</code> class offers a SAX style interface for parsing JSON.  Given a <code>Reader</code>
            of a stream of JSON text, and an implementation of <code>JsonListener</code>, the <code>parse</code> method
            will parse the JSON from the <code>Reader</code>, and call methods on the <code>JsonListener</code> as it
            encounters parse events, such as the start of the document, the start of a field, or a JSON string.</p>
            <p>The following code extracts the names of all the fields in a piece of JSON.  It assumes
            <code>jsonReader</code> refers to a <code>Reader</code> of the example JSON in the previous section.</p>
        <div class="code">import static argo.format.JsonNumberUtils.asBigDecimal;

...

private static final SajParser SAJ_PARSER
        = new SajParser();

...

final Set&lt;String&gt; fieldNames = new HashSet&lt;String&gt;();
SAJ_PARSER.parse(jsonReader, new JsonListener() {
    public void startField(String name) {
        fieldNames.add(name);
    }
    public void startDocument() { }
    public void endDocument() { }

...

}); </div>
        <h3>Parsing JSON through iteration</h3>
        <p>The <code>StajParser</code> class allows the calling code to request parsing events from a stream of JSON
        text, similar to how the StAX parser works for XML.</p>
        <p>The following code gets the names of all the fields in a piece of JSON using the <code>StajParser</code>.
        Again, it assumes <code>jsonReader</code> refers to a <code>Reader</code> of the example JSON in the previous
            section.</p>
        <div class="code">Set&lt;String&gt; fieldNames = new HashSet&lt;String&gt;();
StajParser stajParser = null;
try {
    stajParser = new StajParser(jsonReader);
    while (stajParser.hasNext()) {
        if (stajParser.next() == JsonStreamElementType.START_FIELD) {
            fieldNames.add(stajParser.getText());
        }
    }
} finally {
    if (stajParser != null) {
        stajParser.close();
    }
}</div>
        <p>Note that it is important to call <code>close()</code> when finished with an instance of
            <code>StajParser</code> to free up resource associated with it.</p>
    </div>
    <div id="footer">
        <ul>
            <li>
                <a href="http://sourceforge.net/projects/argo">
                    <img src="http://sflogo.sourceforge.net/sflogo.php?group_id=245339&amp;type=13"
                         alt="Get Argo at SourceForge.net. Fast, secure and Free Open Source software downloads"
                         height="30" width="120"/>
                </a>
            </li>
            <li>
                <a href="http://jigsaw.w3.org/css-validator/check/referer">
                    <img src="http://jigsaw.w3.org/css-validator/images/vcss" alt="Valid CSS!" height="31" width="88"/>
                </a>
            </li>
            <li>
                <a href="http://validator.w3.org/check?uri=referer">
                    <img src="http://www.w3.org/Icons/valid-xhtml10" alt="Valid XHTML 1.0 Strict" height="31"
                         width="88"/>
                </a>
            </li>
        </ul>
    </div>
</div>
<div>
    <!-- Piwik -->
    <script type="text/javascript" src="piwik_1.js"></script>
    <script type="text/javascript" src="piwik_2.js"></script>
    <object>
        <noscript><p><img src="http://sourceforge.net/apps/piwik/argo/piwik.php?idsite=1" alt="piwik"/></p></noscript>
    </object>
    <!-- End Piwik Tag -->
</div>
</body>
</html>